{
  "name": "sliding-window-analysis",
  "operators": [
    {
      "id": "source",
      "type": "source",
      "args": {
        "type": "http",
        "endpoint": "/api/v1/ingest"
      }
    },
    {
      "id": "extract_metrics",
      "type": "map",
      "fn": "extract_metric_value"
    },
    {
      "id": "key_by_metric",
      "type": "key_by",
      "key": "metric_name"
    },
    {
      "id": "sliding_avg",
      "type": "window_aggregate",
      "fn": "average"
    },
    {
      "id": "threshold_filter",
      "type": "filter",
      "fn": "exceeds_threshold"
    },
    {
      "id": "alert_sink",
      "type": "sink",
      "args": {
        "type": "file",
        "path": "output/alerts.jsonl"
      }
    }
  ],
  "wiring": [
    ["source", "extract_metrics"],
    ["extract_metrics", "key_by_metric"],
    ["key_by_metric", "sliding_avg"],
    ["sliding_avg", "threshold_filter"],
    ["threshold_filter", "alert_sink"]
  ],
  "windows": {
    "type": "sliding",
    "size_seconds": 300,
    "slide_seconds": 60
  },
  "config": {
    "threshold": 95,
    "checkpoint_interval_seconds": 30,
    "parallelism": 4
  }
}
